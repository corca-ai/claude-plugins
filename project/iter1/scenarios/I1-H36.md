# I1-H36 `compact-context` inject/guard 분기

## 목적

`SessionStart(compact)` 훅에서 live state 기반 컨텍스트 주입과 worktree mismatch guard 경고가 동작하는지 검증한다.

## 실행 일시

2026-02-19

## 실행 환경

- 실행 스크립트: [compact-context.sh](../../../plugins/cwf/hooks/scripts/compact-context.sh)
- 실행 로그: [project/iter1/artifacts/I1-H36.log](../artifacts/I1-H36.log)
- 임시 git repo:
  - inject: 시스템 임시 디렉터리 테스트 저장소(cwf-h36-inject)
  - guard: 시스템 임시 디렉터리 테스트 저장소(cwf-h36-guard)

## 재현 명령

```bash
CLAUDE_PROJECT_DIR='/tmp/cwf-h36-inject-Enek' \
  jq -nc --arg sid 'sid-h36-inject' --arg cwd '/tmp/cwf-h36-inject-Enek' '{source:"compact",session_id:$sid,cwd:$cwd}' \
  | CLAUDE_PROJECT_DIR='/tmp/cwf-h36-inject-Enek' bash plugins/cwf/hooks/scripts/compact-context.sh

CLAUDE_PROJECT_DIR='/tmp/cwf-h36-guard-f3HY' \
  jq -nc --arg sid 'sid-h36-guard' --arg cwd '/tmp/cwf-h36-guard-f3HY' '{source:"compact",session_id:$sid,cwd:$cwd}' \
  | CLAUDE_PROJECT_DIR='/tmp/cwf-h36-guard-f3HY' bash plugins/cwf/hooks/scripts/compact-context.sh
```

## 관찰 결과

- Case A (inject): `exit_code=0`, `hookSpecificOutput.additionalContext` JSON 반환
  - session/phase/task/key_files/dont_touch/decisions 정보 주입 확인
- Case B (guard): `exit_code=0`, `additionalContext` 내 `[WORKTREE ALERT]` 포함
  - 현재 worktree와 expected worktree 불일치 경고 + `cd`, `git switch` 안내 확인

## 판정

- 상태: PASS
- 결론: compact recovery 주입과 guard 경고 분기가 모두 재현됨.
