# I1-H35 `workflow-gate` push block 분기

## 목적

`UserPromptSubmit` 훅에서 `cwf:run` closing gate가 남은 상태에서 `git push` 요청을 차단하는지 검증한다.

## 실행 일시

2026-02-19

## 실행 환경

- 실행 스크립트: [workflow-gate.sh](../../../plugins/cwf/hooks/scripts/workflow-gate.sh)
- 실행 로그: [project/iter1/artifacts/I1-H35.log](../artifacts/I1-H35.log)
- 임시 git repo: 시스템 임시 디렉터리에서 생성한 테스트 저장소(cwf-h35)
- 상태 파일: 테스트 저장소의 cwf-state 파일 (`live.remaining_gates = review-code, refactor, retro, ship`)

## 재현 명령

```bash
jq -nc --arg prompt 'git push origin main' --arg sid 'sess-h35' --arg cwd '/tmp/cwf-h35-s4SV' '{prompt:$prompt,session_id:$sid,cwd:$cwd}' \
  | bash plugins/cwf/hooks/scripts/workflow-gate.sh

jq -nc --arg prompt '다음 게이트 진행해' --arg sid 'sess-h35' --arg cwd '/tmp/cwf-h35-s4SV' '{prompt:$prompt,session_id:$sid,cwd:$cwd}' \
  | bash plugins/cwf/hooks/scripts/workflow-gate.sh
```

## 관찰 결과

- Case A (`git push`): `exit_code=1`, `{"decision":"block"...}` 반환
  - block 사유에 `run-closing gates are still pending` 포함
- Case B (비보호 프롬프트): `exit_code=0`, `{"decision":"allow"...}` + 파이프라인 상태 경고 반환

## 판정

- 상태: PASS
- 결론: push 차단 분기가 정상 동작하며, 비보호 요청은 상태 경고와 함께 통과함.
