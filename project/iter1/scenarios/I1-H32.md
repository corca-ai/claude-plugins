# I1-H32 `check-deletion-safety` block/allow 분기

## 목적

`PreToolUse(Bash)` 삭제 안전 훅에서 호출자 참조가 있는 파일 삭제는 차단되고, 외부 임시 파일 삭제는 통과되는지 검증한다.

## 실행 일시

2026-02-19

## 실행 환경

- 실행 스크립트: [check-deletion-safety.sh](../../../plugins/cwf/hooks/scripts/check-deletion-safety.sh)
- 실행 로그: [project/iter1/artifacts/I1-H32.log](../artifacts/I1-H32.log)

## 재현 명령

```bash
jq -nc '{tool_name:"Bash",tool_input:{command:"rm plugins/cwf/hooks/scripts/cwf-hook-gate.sh"}}' \
  | bash plugins/cwf/hooks/scripts/check-deletion-safety.sh

jq -nc --arg cmd 'rm /tmp/cwf-h32-allow.txt' '{tool_name:"Bash",tool_input:{command:$cmd}}' \
  | bash plugins/cwf/hooks/scripts/check-deletion-safety.sh
```

## 관찰 결과

- Case A (repo 파일 삭제): `exit_code=1`, `{"decision":"block"...}` 반환
- block 사유에 런타임 호출자 미리보기 포함 ([AGENTS.md](../../../AGENTS.md), [plugins/cwf/hooks/README.md](../../../plugins/cwf/hooks/README.md) 등)
- Case B (`/tmp` 외부 파일 삭제): `exit_code=0`, 출력 없음 (`allow`)

## 판정

- 상태: PASS
- 결론: 보호 대상 삭제 차단 + 외부 임시 파일 허용 분기가 의도대로 재현됨.
