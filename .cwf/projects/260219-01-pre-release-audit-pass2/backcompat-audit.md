# Backcompat audit (pre-release pass 2)

## Required
- **Per-user hook disable gate** (`plugins/cwf/hooks/scripts/cwf-hook-gate.sh`, lines 10‑33): we must continue to source `~/.claude/cwf-hooks-enabled.sh` and honor the `HOOK_<GROUP>_ENABLED` flag because v2 installations already expose that toggle (and CI docs describe editing it). Removing it would break the only supported way for users to opt hooks out without running `cwf:setup`, so the gate stays as a deliberate compatibility contract.

## Optional (user decision needed)
- **Codex skill sync legacy cleanup** (`plugins/cwf/scripts/codex/sync-skills.sh`, lines 220‑257 and related setup references in `plugins/cwf/skills/setup/references/codex-scope-integration.md`): the `--cleanup-legacy` path still moves `~/.codex/skills/*` entries that pre‑v3 standalone plugins left behind. Early adopters might still trigger it, but every unshipped v3 install now starts from a clean `~/.codex/skills` layout, so the flag mostly resurfaces redundant logging. Removing the option/logic shrinks the user-visible command surface, but it also drops an automated migration hook for stray legacy installs, so I need your decision on whether we keep the cleanup hook until we are confident no v2 caches exist.

## Remove-now candidates
- **Legacy env var migration script** (`plugins/cwf/skills/setup/scripts/migrate-env-vars.sh`, lines 98‑123): this script is the only place still referencing `CLAUDE_CORCA_*`, `CLAUDE_ATTENTION_*`, and other v2 env names, yet no runtime code reads those variables anymore. The mapping is pure baggage now—every skill, hook, and doc already prefers the canonical `CWF_*` names. As soon as we drop the script and the surrounding setup instructions, users will simply be told to rename their env vars manually, which is acceptable for a clean pre-release.
- **Session log path fallback** (`plugins/cwf/hooks/scripts/log-turn.sh`, lines 72‑80): once `plugins/cwf/scripts/cwf-artifact-paths.sh` exists (it ships with every hook), `resolve_cwf_session_logs_dir` is always defined, so the fallback branch that looks for `ARTIFACT_ROOT/sessions` or the legacy `ARTIFACT_ROOT/projects/sessions` never runs. That branch is a read‑only holdover from the old artifact layout; removing it would leave the script relying solely on the canonical resolver, reducing confusion and failure modes (missing `CWF_*` env today implies misinstallation rather than running dead code).
- **Plugin layout detection branch** (`plugins/cwf/scripts/codex/sync-skills.sh`, lines 176‑230): the “plugin-local layout vs repository root layout” branch was only necessary when the marketplace shipped `skills/`/`references/` at the repo root. Our tree now puts every skill under `plugins/cwf/skills`, and the root never stores a standalone `skills/` tree, so the `if [[ -d "$REPO_ROOT/skills" ]]` branch never fires. Removing that branch lets us assume the marketplace layout, simplifies path handling, and eliminates the outdated comment about a “legacy/dev scripts path”.

<!-- AGENT_COMPLETE -->
