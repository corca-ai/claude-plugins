# Agent Operating Guide

Keep stable invariants here; keep implementation detail in scoped docs.

## Operating Invariants

- Prioritize task-level goals over local optimizations. Choose execution details autonomously.
- The user communicates in Korean. Respond in Korean for conversation and English for code/docs (unless explicitly requested otherwise).
- Treat `cwf:<skill>` commands as reserved CWF namespace routes; do not substitute similarly named skills from other plugins.
- If implementation diverges from a pre-designed plan, record the discrepancy in session lessons, report it immediately, and ask for a user decision before proceeding.
- Never delete user-created files without explicit confirmation. Prefer `mv` over `rm`.
- For design decisions, surface meaningful alternatives with trade-offs and incorporate user-provided external references before concluding.
- For plugin code or plugin metadata changes, run local [plugin-deploy](.claude/skills/plugin-deploy/SKILL.md) as the default lifecycle workflow.
- Deterministic gates define pass/fail authority; prose must not duplicate or override them.
- Context-deficit resilience is mandatory across skills: after auto-compact/session restart, execution must recover from persisted state/artifacts/handoff files, not implicit conversational memory.
- Missing dependency handling is interactive by default: ask whether to install/configure now, run it on approval, then retry once before fallback.

## Before Editing Docs

- Read [docs/documentation-guide.md](docs/documentation-guide.md) first (principles and scope ownership).
- Read [plugins/cwf/skills/refactor/references/docs-criteria.md](plugins/cwf/skills/refactor/references/docs-criteria.md) section 0 before proposing new doc rules.
- For automatable issues, update deterministic gates first ([.markdownlint-cli2.jsonc](.markdownlint-cli2.jsonc), [plugins/cwf/hooks/hooks.json](plugins/cwf/hooks/hooks.json), [plugins/cwf/skills/refactor/scripts/check-links.sh](plugins/cwf/skills/refactor/scripts/check-links.sh), [plugins/cwf/skills/refactor/scripts/doc-graph.mjs](plugins/cwf/skills/refactor/scripts/doc-graph.mjs)); keep prose changes for non-automatable policy.

## Document Map

Select autonomously what to read or update using the file descriptions in the block below.

<!-- CWF:INDEX:START -->
> Generated by `cwf:setup --repo-index --target agents`.

### Root — Repository-wide orientation and current runtime/session status

- [README](README.md): Repository overview and install/update entry.
- [AGENTS](AGENTS.md): Cross-runtime invariants and navigation map.
- [CLAUDE](CLAUDE.md): Claude runtime adapter and runtime-specific deltas.
- [cwf-state](.cwf/cwf-state.yaml): Live workflow state and stage checkpoints (SSOT).
- [README.ko](README.ko.md): Korean mirror of repository overview.

### plugins/cwf/skills — CWF workflow design, execution, and orchestration changes

- [setup](plugins/cwf/skills/setup/SKILL.md): Setup workflow and index generation policy.
- [update](plugins/cwf/skills/update/SKILL.md): Version check and update workflow.
- [gather](plugins/cwf/skills/gather/SKILL.md): Information acquisition workflow.
- [clarify](plugins/cwf/skills/clarify/SKILL.md): Requirement clarification workflow.
- [plan](plugins/cwf/skills/plan/SKILL.md): Plan drafting workflow.
- [review](plugins/cwf/skills/review/SKILL.md): Multi-review orchestration.
- [hitl](plugins/cwf/skills/hitl/SKILL.md): Human-in-the-loop diff/chunk review with resumable state.
- [impl](plugins/cwf/skills/impl/SKILL.md): Plan-to-implementation orchestration.
- [retro](plugins/cwf/skills/retro/SKILL.md): Retrospective workflow.
- [handoff](plugins/cwf/skills/handoff/SKILL.md): Session and phase handoff synthesis.
- [ship](plugins/cwf/skills/ship/SKILL.md): Issue/PR/merge workflow.
- [run](plugins/cwf/skills/run/SKILL.md): End-to-end pipeline orchestration.
- [refactor](plugins/cwf/skills/refactor/SKILL.md): Multi-mode refactor/docs review workflow.

Skill-internal files are documented in each skill-local README (for example, [clarify README](plugins/cwf/skills/clarify/README.md)).

### plugins/cwf/references — Multi-skill concept/protocol consistency

- [skill-conventions](plugins/cwf/references/skill-conventions.md): Cross-skill convention baseline.
- [plan-protocol](plugins/cwf/references/plan-protocol.md): Plan quality and structure protocol.
- [agent-patterns](plugins/cwf/references/agent-patterns.md): Shared multi-agent orchestration patterns.
- [context-recovery-protocol](plugins/cwf/references/context-recovery-protocol.md): Compact recovery and persistence protocol.
- [concept-map](plugins/cwf/references/concept-map.md): Concept synchronization map across composing skills.
- [expert-advisor-guide](plugins/cwf/references/expert-advisor-guide.md): Expert advisor operation model.

### plugins/cwf/hooks — Deterministic runtime hook behavior and gating logic

- [hooks manifest](plugins/cwf/hooks/hooks.json): Hook registration manifest.
- [cwf-hook-gate](plugins/cwf/hooks/scripts/cwf-hook-gate.sh): Runtime hook gate and toggle logic.
- [hooks script map](plugins/cwf/hooks/README.md): Map of hook-local scripts and responsibilities.

### plugins/cwf/scripts — CWF operational scripts used by setup/session flows

- [scripts map](plugins/cwf/scripts/README.md): Map of operational scripts under [plugins/cwf/scripts](plugins/cwf/scripts).

### scripts — Deterministic automation, verification, and maintenance operations

Runtime behavior belongs in [plugins/cwf/hooks](plugins/cwf/hooks/); repository operations belong in [scripts](scripts/).

- [check-schemas](scripts/check-schemas.sh): JSON schema validation for tracked CWF config/manifests.
- [doc-churn](scripts/doc-churn.sh): Documentation churn/staleness reporting from git history.
- [find-duplicates](scripts/find-duplicates.py): Near-duplicate markdown block detection.

### docs — Project standards, architectural decisions, and documentation policy

- [project-context](docs/project-context.md): Project/org facts and long-lived conventions.
- [architecture-patterns](docs/architecture-patterns.md): Implementation and integration patterns.
- [cwf-artifact-migration-plan](docs/cwf-artifact-migration-plan.md): Stage-based `.cwf` artifact migration roadmap.
- [documentation-guide](docs/documentation-guide.md): Documentation quality principles and scope rules.
- [plugin-dev-cheatsheet](docs/plugin-dev-cheatsheet.md): Practical development/testing/deploy workflows.
- [interactive-doc-review-protocol](docs/interactive-doc-review-protocol.md): Interactive documentation review process and chunking strategy.

### references — External conceptual frameworks used by this repository

- [anthropic-skills-guide/README](references/anthropic-skills-guide/README.md): Anthropic skills guide index.
- [essence-of-software/distillation](references/essence-of-software/distillation.md): Core concept distillation used by review and design docs.
- [sw-factory/analysis](references/sw-factory/analysis.md): Analysis report on software-factory patterns and the agentic development model.
<!-- CWF:INDEX:END -->
