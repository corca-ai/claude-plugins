# Session: 39ee887b
Model: claude-opus-4-6 | Branch: main
CWD: /home/hwidong/codes/claude-plugins
Started: 2026-02-08 12:01:08 KST | Claude Code v2.1.37

---
## Turn 1 [12:01:08 → 12:04:53] (225s) | Tokens: 5558↑ 5870↓

### User
Implement the following plan:

# S3 Plan: Build `/ship` Skill

## Context

The cwf v3 migration (S3–S14) requires frequent GitHub operations: creating issues for each session, opening PRs from feature branches to `marketplace-v3`, and merging when approved. `/ship` automates this cycle as a repo-level skill, eliminating manual `gh` CLI invocations and ensuring consistent PR body formatting (lessons, CDM, review checklist).

This is the first session on `marketplace-v3` branch.

## Scope

- **Subcommands**: `issue`, `pr`, `merge`, `status` (no `full` — agent composes as needed)
- **Base branch**: configurable via `--base` (default: `marketplace-v3`)
- **Type**: Instruction-only SKILL.md with reference templates (no scripts)

## File Structure

```text
.claude/skills/ship/
├── SKILL.md                    # Core instructions (<500 lines)
└── references/
    ├── pr-template.md          # PR body template with {VARIABLES}
    └── issue-template.md       # Issue body template with {VARIABLES}
```

## Implementation Steps

- [ ] 1. Create `marketplace-v3` branch from `main`
- [ ] 2. Create session artifacts: `prompt-logs/260208-06-ship-skill/plan.md`, `lessons.md`
- [ ] 3. Write `references/issue-template.md` — issue body with {PURPOSE}, {SUCCESS_CRITERIA}, {SCOPE}
- [ ] 4. Write `references/pr-template.md` — PR body with {SUMMARY}, {ISSUE_LINK}, {GIT_DIFF_STAT}, {LESSONS}, {CDM}, review checklist
- [ ] 5. Write `SKILL.md` — frontmatter + 4 subcommand workflows + usage message
- [ ] 6. Test: invoke `/ship` (usage), `/ship status`, `/ship issue`, `/ship pr` against live repo
- [ ] 7. Session wrap-up: update plan.md ✅, lessons.md, next-session.md, `/retro`, commit & push

## SKILL.md Design

### Frontmatter

```yaml
---
name: ship
description: |
  Automate GitHub workflow: issue creation, PR with lessons/CDM/checklist,
  and merge management. Triggers: "/ship"
allowed-tools:
  - Bash
  - Read
  - Glob
  - Grep
---
```

### Subcommand Summary

| Command | Action |
|---------|--------|
| `/ship` | Show usage |
| `/ship issue [--base B] [--no-branch]` | Create issue + feature branch |
| `/ship pr [--base B] [--issue N] [--draft]` | Create PR linked to issue |
| `/ship merge [--squash\|--merge\|--rebase]` | Check status & merge if ready |
| `/ship status` | Show open issues, PRs, check/review status |

### `/ship issue` Workflow

1. Prerequisite: `command -v gh && gh auth status`
2. Detect session context: find current session dir in `prompt-logs/`, read plan.md/master-plan.md
3. Compose issue body from `references/issue-template.md`
4. `gh issue create --title "S{N}: {title}" --body "..." --label "cwf-v3"`
5. Create feature branch from base: `git checkout {base} && git pull && git checkout -b feat/{name}`
6. Report: issue URL + branch name

### `/ship pr` Workflow

1. Pre-flight: not on main/marketplace-v3, has commits ahead of base, no uncommitted changes
2. Auto-detect linked issue: `gh issue list --search "S{N}" --json number,title`
3. Build PR body from `references/pr-template.md`:
   - Summary from `git log {base}..HEAD --oneline`
   - `Closes #{N}` if issue found
   - `git diff {base}...HEAD --stat` for changes
   - Extract lessons from `lessons.md` if exists
   - Extract CDM from `retro.md` if exists
   - Static review checklist (conditional items based on changed file types)
4. `git push -u origin {branch} && gh pr create --title "..." --body "..." --base {base}`
5. Report: PR URL

### `/ship merge` Workflow

1. Find PR: `gh pr view --json number,state,reviewDecision,statusCheckRollup,mergeable`
2. Assess: approved + checks passed + mergeable → merge; otherwise report blocking reason
3. `gh pr merge {N} --squash --delete-branch` (default squash; `--merge`/`--rebase` flags)
4. Post-merge: `git checkout {base} && git pull`

### `/ship status` Workflow

1. `gh issue list --label cwf-v3 --json number,title,state` — open issues
2. `gh pr list --json number,title,state,headRefName,reviewDecision` — open PRs
3. Current branch PR status if exists
4. Parse master-plan.md session roadmap for progress overview

## Error Handling

- `gh` not found → report, suggest install, stop
- Not authenticated → `gh auth login` instructions, stop
- No commits ahead of base → report, stop (don't create empty PR)
- Issue/PR already exists → ask user before proceeding
- Merge conflicts → report, suggest rebase instructions
- Missing session artifacts (lessons.md, retro.md) → proceed with placeholder text, not failure

## Verification

1. `/ship` → prints usage message
2. `/ship status` → lists current repo issues/PRs (read-only, safe to run first)
3. `/ship issue` → creates issue on GitHub, creates feature branch (verify with `gh issue view` + `git branch`)
4. `/ship pr` → creates PR linked to issue (verify with `gh pr view`)
5. End-to-end: issue → branch → commit → PR → (manual approval) → merge

## Success Criteria

```gherkin
Given gh CLI is authenticated and marketplace-v3 branch exists
When user invokes `/ship issue`
Then a GitHub issue is created with session context and a feature branch is checked out

Given a feature branch with commits ahead of base
When user invokes `/ship pr`
Then a PR is created with lessons, CDM section, review checklist, linked to the issue

Given an approved PR with passing checks
When user invokes `/ship merge`
Then the PR is squash-merged and branch is deleted

Given any state
When user invokes `/ship status`
Then current issues, PRs, and session progress are displayed
```

## Deferred Actions

- (none)


If you need specific details from before exiting plan mode (like exact code snippets, error messages, or content you generated), read the full transcript at: /home/hwidong/.claude/projects/-home-hwidong-codes-claude-plugins/e89f3e88-e3a9-4198-bcc7-b1648a75448c.jsonl

If this plan can be broken down into multiple independent tasks, consider using the TeamCreate tool to create a team and parallelize the work.

### Assistant (70 lines → truncated)
I'll implement the `/ship` skill according to the plan. Let me start by reading the required docs and setting up the environment.
Plan says this is a local skill (`.claude/skills/ship/`), not a marketplace plugin. Let me check existing local skills for patterns and look at the prompt-logs directory.
Good. Session artifacts already exist. Now let me create the task list and start implementing.
Now let me create the skill directory and write both templates in parallel.


...(60 lines truncated)...

`.markdownlint.json`을 확인한 결과, **MD013 (80자 줄바꿈)과 MD060 (테이블 열 수) 모두 이미 `false`로 비활성화**되어 있습니다. 린터 규칙 자체가 문제가 아니라 에이전트가 자체적으로 줄을 끊고 있는 것일 수 있습니다. 어떤 상황에서 발생했는지 확인해주시면 정확히 대응하겠습니다.

---

커밋 및 `/retro`를 진행할까요?

### Tools
1. Read `/home/hwidong/codes/claude-plugins/docs/plugin-dev-cheatsheet.md`
2. Read `/home/hwidong/codes/claude-plugins/docs/skills-guide.md`
3. Bash `git branch -a | head -20`
4. Bash `ls -la /home/hwidong/codes/claude-plugins/.claude/skills/ 2>/dev/null || echo "N`
5. Bash `ls /home/hwidong/codes/claude-plugins/prompt-logs/ | tail -10`
6. Glob `.claude/skills/**/SKILL.md`
7. Read `/home/hwidong/codes/claude-plugins/.claude/skills/plugin-deploy/SKILL.md`
8. Bash `ls -la /home/hwidong/codes/claude-plugins/prompt-logs/260208-06-ship-skill/`
9. Bash `ls /home/hwidong/codes/claude-plugins/.claude/skills/plugin-deploy/`
10. TaskCreate "Create marketplace-v3 branch from main"
11. TaskCreate "Write references/issue-template.md"
12. TaskCreate "Write references/pr-template.md"
13. TaskCreate "Write SKILL.md with 4 subcommands"
14. TaskCreate "Test /ship subcommands"
15. TaskCreate "Session wrap-up"
16. TaskUpdate #1 → in_progress
17. Bash `git checkout -b marketplace-v3`
18. TaskUpdate #1 → completed
19. TaskUpdate #2 → in_progress
20. TaskUpdate #3 → in_progress
21. Bash `mkdir -p /home/hwidong/codes/claude-plugins/.claude/skills/ship/references`
22. Write `/home/hwidong/codes/claude-plugins/.claude/skills/ship/references/issue-template.md`
23. Write `/home/hwidong/codes/claude-plugins/.claude/skills/ship/references/pr-template.md`
24. Read `/home/hwidong/codes/claude-plugins/.claude/skills/ship/references/pr-template.md`
25. Write `/home/hwidong/codes/claude-plugins/.claude/skills/ship/references/pr-template.md`
26. Read `/home/hwidong/codes/claude-plugins/.claude/skills/ship/references/issue-template.md`
27. Write `/home/hwidong/codes/claude-plugins/.claude/skills/ship/references/issue-template.md`
28. TaskUpdate #2 → completed
29. TaskUpdate #3 → completed
30. TaskUpdate #4 → in_progress
31. Write `/home/hwidong/codes/claude-plugins/.claude/skills/ship/SKILL.md`
32. Bash `wc -l /home/hwidong/codes/claude-plugins/.claude/skills/ship/SKILL.md`
33. TaskUpdate #4 → completed
34. TaskUpdate #5 → in_progress
35. Bash `find /home/hwidong/codes/claude-plugins/.claude/skills/ship/ -type f | sort`
36. Bash `gh auth status 2>&1`
37. Bash `gh issue list --label cwf-v3 --state open --json number,title,assignees 2>&1 | h`
38. Bash `gh pr list --json number,title,state,headRefName,reviewDecision 2>&1 | head -5`
39. TaskUpdate #5 → completed
40. Read `/home/hwidong/codes/claude-plugins/.markdownlint.json`
41. TaskUpdate #6 → in_progress
42. Read `/home/hwidong/codes/claude-plugins/prompt-logs/260208-06-ship-skill/plan.md`
43. Read `/home/hwidong/codes/claude-plugins/prompt-logs/260208-06-ship-skill/lessons.md`
44. Write `/home/hwidong/codes/claude-plugins/prompt-logs/260208-06-ship-skill/plan.md`
45. Write `/home/hwidong/codes/claude-plugins/prompt-logs/260208-06-ship-skill/lessons.md`

---
## Turn 2 [12:10:51 → 12:18:20] (449s) | Tokens: 19869↑ 6043↓

### User
커밋하고 /retro 진행해주세요. next-session은 잘 만들어져 있나요?

### Assistant (34 lines → truncated)
next-session.md가 없습니다. 만들어야 합니다. 그리고 이전 세션(S2)에서 next-session.md를 빠뜨린 건이 이미 lessons로 기록된 걸 보면, 이번에도 빠뜨리면 안 되겠습니다. 먼저 next-session.md를 만들고 커밋하겠습니다.
좋은 포맷 참고가 되었습니다. master plan에서 S4 내용을 확인하겠습니다.
이제 커밋하겠습니다.
커밋 완료. 이제 `/retro` 실행하겠습니다.


...(24 lines truncated)...

a74a117 docs: S3 retro — /ship skill session retrospective
7afb998 feat: add /ship skill — GitHub workflow automation for cwf sessions
```

push는 필요하시면 말씀해주세요. (untracked `prompt-logs/sessions/260208-1201-39ee887b.md`는 prompt-logger가 자동 커밋할 세션 로그입니다.)

### Tools
1. Bash `ls /home/hwidong/codes/claude-plugins/prompt-logs/260208-06-ship-skill/`
2. Bash `git -C /home/hwidong/codes/claude-plugins status`
3. Bash `git -C /home/hwidong/codes/claude-plugins diff --stat`
4. Bash `git -C /home/hwidong/codes/claude-plugins log --oneline -5`
5. Bash `ls /home/hwidong/codes/claude-plugins/prompt-logs/260208-05-refactor-s2/`
6. Read `/home/hwidong/codes/claude-plugins/prompt-logs/260208-05-refactor-s2/next-session.md`
7. Glob `**/master-plan*`
8. Read `/home/hwidong/codes/claude-plugins/prompt-logs/260208-03-cwf-v3-master-plan/master-plan.md`
9. Write `/home/hwidong/codes/claude-plugins/prompt-logs/260208-06-ship-skill/next-session.md`
10. Bash `git -C /home/hwidong/codes/claude-plugins add .claude/skills/ship/SKILL.md .clau`
11. Bash `git -C /home/hwidong/codes/claude-plugins diff --cached --stat`
12. Bash `git commit -m "$(cat <<'EOF'
feat: add /ship skill — GitHub workflow automation `
13. Bash `git -C /home/hwidong/codes/claude-plugins status`
14. Skill `retro`
15. Read `/home/hwidong/codes/claude-plugins/prompt-logs/260208-06-ship-skill/plan.md`
16. Read `/home/hwidong/codes/claude-plugins/prompt-logs/260208-06-ship-skill/lessons.md`
17. Read `/home/hwidong/codes/claude-plugins/CLAUDE.md`
18. Read `/home/hwidong/codes/claude-plugins/docs/project-context.md`
19. Read `/home/hwidong/.claude/plugins/cache/corca-plugins/retro/2.0.2/skills/retro/references/cdm-guide.md`
20. Glob `/home/hwidong/.claude/plugins/*/skills/*/SKILL.md`
21. Glob `/home/hwidong/codes/claude-plugins/.claude/skills/*/SKILL.md`
22. Glob `/home/hwidong/.claude/plugins/**/skills/*/SKILL.md`
23. Bash `ls /home/hwidong/codes/claude-plugins/prompt-logs/sessions/260208-*.md 2>/dev/nu`
24. Bash `ls /home/hwidong/codes/claude-plugins/prompt-logs/sessions/260208-12*.md 2>/dev/`
25. Read `/home/hwidong/codes/claude-plugins/prompt-logs/sessions/260208-1201-39ee887b.md`
26. Bash `ls -la /home/hwidong/codes/claude-plugins/prompt-logs/260208-06-ship-skill/sessi`
27. Bash `ln -s "../sessions/260208-1201-39ee887b.md" "/home/hwidong/codes/claude-plugins/`
28. Write `/home/hwidong/codes/claude-plugins/prompt-logs/260208-06-ship-skill/retro.md`
29. Edit `/home/hwidong/codes/claude-plugins/prompt-logs/260208-06-ship-skill/plan.md`
30. AskUserQuestion "next-session.md 프로세스 갭을 project-context.md의 Process Heuristi"
31. Bash `git -C /home/hwidong/codes/claude-plugins add prompt-logs/260208-06-ship-skill/r`
32. Bash `git -C /home/hwidong/codes/claude-plugins diff --cached --stat`
33. Bash `git -C /home/hwidong/codes/claude-plugins commit -m "$(cat <<'EOF'
docs: S3 retr`
34. Bash `git -C /home/hwidong/codes/claude-plugins status`
35. TaskUpdate #6 → completed

---
## Turn 3 [12:18:56 → 12:19:08] (12s) | Tokens: 4↑ 100↓

### User
푸시합시다. 고생하셨어요.

### Assistant (3 lines)
푸시 완료. `marketplace-v3` 브랜치가 remote에 생성되었습니다.

다음 세션(S4)에서 `/ship issue`로 첫 이슈를 만들어볼 수 있습니다.

### Tools
1. Bash `git -C /home/hwidong/codes/claude-plugins push -u origin marketplace-v3`
