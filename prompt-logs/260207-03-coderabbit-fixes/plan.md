# Plan: CodeRabbit PR #7 리뷰 적용 + plugin-deploy 개선

## Success Criteria

```gherkin
Given CodeRabbit PR #7 comments and retro findings
When all applicable fixes are implemented
Then:
  - check-consistency.sh correctly detects "deprecated + still in marketplace" as a gap
  - All gather-context curl calls survive network failures (set +e guard)
  - All arg-taking flags validate their values before use
  - update-all.sh works in non-interactive shells
  - quick-scan.sh handles empty anthropic_flags and REPO_ROOT fallback correctly
  - No bare ``` code fences remain in plugin/reference markdown files
  - .markdownlint.json config exists and passes on fixed files
```

## Triage Summary: 26 CodeRabbit Comments

| Verdict | Count | Category |
|---------|-------|----------|
| **Apply** | 24 | Script bugs, MD040 lint, plugin-deploy logic |
| **Skip** | 6 | Auto-generated prompt-logs, already-fixed items, editorial nitpicks |

### Skipped Items (with reasons)
- `docs/project-context.md` retro version — already v2.0.0
- `README.md` / `README.ko.md` table spacing — verified: already correct
- `03-skill-structure.md` code block spacing — verified: already correct
- `prompt-logs/sessions/*.md` cosmetic fixes — auto-generated by prompt-logger
- `prompt-logs/lessons.md` heading levels — intentional style
- Session log PII (absolute paths) — personal repo, expected

## Execution: 4 Parallel Workstreams

### WS1: plugin-deploy (3 files, local skill) ✅

| # | File | Change |
|---|------|--------|
| 1 | `.claude/skills/plugin-deploy/SKILL.md:58` | ✅ Rewrite "Deprecated flag mismatch" row → "Remove from marketplace.json + clean cache" |
| 2 | `.claude/skills/plugin-deploy/scripts/check-consistency.sh:88-108` | ✅ Rewrite Section 3b: detect deprecated=true + in_marketplace → gap |
| 3 | `.claude/skills/plugin-deploy/references/checklist.md` | ✅ Add "Deprecation Checklist" section |

### WS2: Script bug fixes (5 files) ✅

| # | File | Change |
|---|------|--------|
| 4 | `scripts/update-all.sh:42` | ✅ Guard `read -r` with `[[ -t 0 ]]` |
| 5-7 | `gather-context scripts (3)` | ✅ `set +e` around curl, `set -e` after |
| 8-10 | `gather-context scripts (3)` | ✅ Arg value validation for --tokens, --query, --topic, --time-range |
| 11 | `code-search.sh:2` | ✅ Header: "web-search" → "gather-context" |
| 12 | `quick-scan.sh:10` | ✅ REPO_ROOT fallback: wrap in `{ ...; }` |
| 13 | `quick-scan.sh:135-139` | ✅ Guard empty `anthropic_flags` array |

### WS3: Markdown lint fixes (30+ files) ✅

- ✅ MD040: bare code fences → language specifier (expanded to full codebase)
- ✅ MD024: Duplicate headings in clarify SKILL.md (Sub-agent A/B → +Path A/B) and research-guide.md
- 2 false positive MD040 from nested code fences (markdownlint limitation) — unfixable

### WS4: markdownlint config (2 new files) ✅

- ✅ `.markdownlint.json` — rules config (disabled noisy rules: MD031, MD032, MD034, MD060)
- ✅ `.markdownlintignore` — exclude `prompt-logs/`

## Post-Implementation

1. ✅ Version bumps: gather-context 2.0.1, clarify 2.0.1, refactor 1.0.1
2. ✅ Verify scripts + markdownlint
3. /plugin-deploy for each affected plugin
4. Commit, push, update-all.sh

## Deferred Actions

- (none)
